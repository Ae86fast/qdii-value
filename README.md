# qdii-value

估算 QDII 基金的净值（仅对持仓主要为股票的基金适用）

## 注意

- 未考虑汇率等因素

- 数值仅供参考，不作为任何依据

- 投资有风险，操作需谨慎

- 仅供学习交流使用

## 介绍

1. 通过抓取 eastmoney 上基金最近的持仓报告，获取持仓前 x 股票代码

- (可选) 通过 smartkarma.com 将股票代码转为公司名

2. 在 investing.com 上查询每只股票当前行情

## 使用

Python 3.5+, Node.js 10+ 环境（抓 smartkarma 需要 bypass CF 的 cfscrape 库需要 Node）

```bash
# 安装依赖
pip install -r requirements.txt
# 启动脚本，
# -a 参数: id=基金代码
#         exchange=交易所（可选）
#         id_len=股票代码长度（仅对数字型代码适用，可选）
#         name_conv=True（字母代码若匹配不到，使用 smartkarma 转换，可选）
# -o 输出 csv 文件
scrapy crawl funds -a id=007280 -a exchange="东京" -o 006105.csv
```

控制台输出内容包括：

```
i: 开头的是 investing.com 上对应股票页面

c: 开头的是 smartkarma.com 查到的公司名

======================== 持仓表 ========================
6758     索尼                      4.98%   1.25    607.41
6861     基恩士                    4.62%   0.19    563.03
4063     信越化学工业               4.15%   0.61    505.60
8766     东京海上控股               4.06%   1.60    494.67
7203     丰田汽车                   3.43%   0.94    418.29
=======================================================
```

然后查询行情并输出到 csv 文件.

## 问题

- [ ] investing.com 请求太快可能会触发反爬

- [x] 【亟待解决】investing.com 上的股票代码可能与持仓报告中不一致

  - [x] 目前找到匹配度最高的是 Bloomberg，但是国内打不开

    - [ ] 用 smartkarma.com 转换一下，但是有些可能还是没有

  - [x] 数字型的代码可能会匹配到其他市场（现在就是简单取的搜索框第一个匹配的股票）

  - [x] 字母型的代码有的直接跟市场代号，有的有分隔符（`.`/`:`）什么的

- [ ] 交易所可以多选，支持优先顺序匹配

- [ ] 还没做自动加权求和，还是要用 Excel 求一下值
